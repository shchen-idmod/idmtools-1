Bootstrap: library
From: ubuntu:22.04

%labels
    Author idmtools
    Version 1.0
    Description Full Python scientific computing environment

%help
    This container provides Python 3.11 with comprehensive scientific libraries:
    - NumPy, SciPy, Pandas (numerical computing)
    - Matplotlib, Seaborn, Plotly (visualization)
    - Scikit-learn (machine learning)
    - Statsmodels (statistical modeling)
    - NetworkX (graph analysis)
    - SymPy (symbolic mathematics)

    Usage:
        singularity exec python_scientific.sif python3 my_script.py
        singularity exec python_scientific.sif python3 -c "import numpy; print(numpy.__version__)"

%post
    # Update system
    apt-get update && apt-get install -y \
        python3.11 \
        python3-pip \
        python3-dev \
        build-essential \
        gfortran \
        libopenblas-dev \
        liblapack-dev \
        wget \
        ca-certificates

    # Upgrade pip
    python3 -m pip install --upgrade pip setuptools wheel

    # Install scientific Python packages
    pip3 install --no-cache-dir \
        numpy>=1.24.0 \
        scipy>=1.10.0 \
        pandas>=2.0.0 \
        matplotlib>=3.7.0 \
        seaborn>=0.12.0 \
        plotly>=5.14.0 \
        scikit-learn>=1.3.0 \
        statsmodels>=0.14.0 \
        networkx>=3.1 \
        sympy>=1.12 \
        jupyter>=1.0.0 \
        ipython>=8.12.0 \
        h5py>=3.8.0 \
        tables>=3.8.0 \
        xarray>=2023.1.0 \
        dask>=2023.3.0

    # Clean up
    apt-get clean
    rm -rf /var/lib/apt/lists/*
    pip3 cache purge

%environment
    export PYTHONUNBUFFERED=1
    export MPLBACKEND=Agg

%runscript
    exec python3 "$@"
