Bootstrap: library
From: ubuntu:22.04

%labels
    Author idmtools
    Version 1.0
    Description Epidemiological modeling and disease simulation environment

%help
    This container provides Python 3.11 with epidemiological modeling libraries:
    - NumPy, SciPy (numerical methods for ODEs/SDEs)
    - Pandas (data manipulation)
    - Matplotlib, Seaborn (visualization)
    - NetworkX (contact network modeling)
    - Mesa (agent-based modeling framework)

    Ideal for:
    - Compartmental models (SIR, SEIR, etc.)
    - Agent-based models
    - Network-based transmission models
    - Stochastic epidemic simulations

    Usage:
        singularity exec epi_modeling.sif python3 sir_model.py --config config.json

%post
    # Update system
    apt-get update && apt-get install -y \
        python3.11 \
        python3-pip \
        python3-dev \
        build-essential \
        gfortran \
        libopenblas-dev \
        wget \
        ca-certificates \
        jq

    # Upgrade pip
    python3 -m pip install --upgrade pip setuptools wheel

    # Install core scientific packages
    pip3 install --no-cache-dir \
        numpy>=1.24.0 \
        scipy>=1.10.0 \
        pandas>=2.0.0 \
        matplotlib>=3.7.0 \
        seaborn>=0.12.0

    # Install epidemiological modeling packages
    pip3 install --no-cache-dir \
        networkx>=3.1 \
        mesa>=2.1.0 \
        scikit-learn>=1.3.0 \
        statsmodels>=0.14.0

    # Install utilities
    pip3 install --no-cache-dir \
        tqdm>=4.66.0 \
        jupyterlab>=4.0.0 \
        ipython>=8.12.0

    # Clean up
    apt-get clean
    rm -rf /var/lib/apt/lists/*
    pip3 cache purge

%environment
    export PYTHONUNBUFFERED=1
    export MPLBACKEND=Agg
    export OMP_NUM_THREADS=1

%runscript
    exec python3 "$@"
