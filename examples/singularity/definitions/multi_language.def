Bootstrap: library
From: ubuntu:22.04

%labels
    Author idmtools
    Version 1.0
    Description Multi-language environment with Python, R, and Julia

%help
    This container provides Python 3.11, R 4.3+, and Julia 1.9+ with essential packages.
    Ideal for projects requiring multiple languages or cross-language workflows.

    Usage:
        singularity exec multi_language.sif python3 script.py
        singularity exec multi_language.sif Rscript script.R
        singularity exec multi_language.sif julia script.jl

%post
    # Update system
    apt-get update && apt-get install -y \
        python3.11 \
        python3-pip \
        python3-dev \
        r-base \
        r-base-dev \
        build-essential \
        gfortran \
        libopenblas-dev \
        libcurl4-openssl-dev \
        libssl-dev \
        libxml2-dev \
        wget \
        ca-certificates \
        jq

    # Install Python packages
    python3 -m pip install --upgrade pip
    pip3 install --no-cache-dir \
        numpy>=1.24.0 \
        pandas>=2.0.0 \
        matplotlib>=3.7.0 \
        scipy>=1.10.0 \
        scikit-learn>=1.3.0

    # Install R packages
    R -e "install.packages(c('tidyverse', 'jsonlite', 'data.table'), repos='https://cloud.r-project.org/')"

    # Install Julia
    JULIA_VERSION=1.9.3
    cd /tmp
    wget https://julialang-s3.julialang.org/bin/linux/x64/1.9/julia-${JULIA_VERSION}-linux-x86_64.tar.gz
    tar -xzf julia-${JULIA_VERSION}-linux-x86_64.tar.gz
    mv julia-${JULIA_VERSION} /opt/julia
    ln -s /opt/julia/bin/julia /usr/local/bin/julia

    # Install Julia packages
    julia -e 'using Pkg; Pkg.add(["DataFrames", "CSV", "JSON"])'

    # Clean up
    apt-get clean
    rm -rf /var/lib/apt/lists/*
    rm -rf /tmp/*
    pip3 cache purge

%environment
    export PYTHONUNBUFFERED=1
    export MPLBACKEND=Agg
    export LC_ALL=C
    export JULIA_DEPOT_PATH=/opt/julia-depot
    export PATH=/opt/julia/bin:$PATH

%runscript
    echo "Multi-language container: Python, R, and Julia available"
    echo "Use: python3, Rscript, or julia"
